{% extends "layout.twig" %}

{% block title %}Tickets - TicketApp{% endblock %}

{% block content %}
<div class="min-h-screen flex flex-col bg-slate-900">
    <main class="flex-1 px-4 py-12">
        <div class="max-w-6xl mx-auto">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
                <div>
                    <h1 class="text-4xl font-bold text-white mb-2">Tickets</h1>
                    <p class="text-slate-400">Manage and track all your support tickets</p>
                </div>
                <button
                    onclick="toggleForm()"
                    class="mt-4 md:mt-0 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors"
                >
                    <span id="formToggleText">New Ticket</span>
                </button>
            </div>

            <!-- Form -->
            <div id="ticketForm" class="mb-8 hidden">
                {% include 'tickets/form.twig' %}
            </div>

            <!-- Filter -->
            <div class="flex gap-2 mb-8 flex-wrap">
                <a href="/tickets?filter=all" 
                   class="px-4 py-2 rounded-lg font-medium transition-colors {{ filter == 'all' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700' }}">
                    All
                </a>
                <a href="/tickets?filter=open" 
                   class="px-4 py-2 rounded-lg font-medium transition-colors {{ filter == 'open' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700' }}">
                    Open
                </a>
                <a href="/tickets?filter=in_progress" 
                   class="px-4 py-2 rounded-lg font-medium transition-colors {{ filter == 'in_progress' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700' }}">
                    In Progress
                </a>
                <a href="/tickets?filter=closed" 
                   class="px-4 py-2 rounded-lg font-medium transition-colors {{ filter == 'closed' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700' }}">
                    Closed
                </a>
            </div>

            <!-- Tickets List -->
            {% include 'tickets/list.twig' %}
        </div>
    </main>

    {% include 'components/footer.twig' %}
</div>

<script>
    let formVisible = {{ editingTicket ? 'true' : 'false' }};
    
    function toggleForm() {
        const form = document.getElementById('ticketForm');
        const toggleText = document.getElementById('formToggleText');
        formVisible = !formVisible;
        
        if (formVisible) {
            form.classList.remove('hidden');
            toggleText.textContent = 'Cancel';
        } else {
            form.classList.add('hidden');
            toggleText.textContent = 'New Ticket';
            // Reset form if not editing
            if (!{{ editingTicket ? 'true' : 'false' }}) {
                document.getElementById('ticketFormElement').reset();
            }
        }
    }
    
    {% if editingTicket %}
        toggleForm();
    {% endif %}
    
    function confirmDelete(id) {
        if (confirm('Are you sure you want to delete this ticket?')) {
            window.location.href = '/tickets/' + id + '/delete';
        }
    }
</script>
{% endblock %}
